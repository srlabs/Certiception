<!-- 
  This is an example configuration file for user offline certificate requests that are submitted by a
mobile device management system.
  It ensures that the requests contain a syntacical valid userPrincipalName extension.
  After verification, this information is used to search a corresponding user account in Active
Directory.
  It's objectSid property will be written into the SID certificate extension when the certificate is
issued.
-->
<CertificateRequestPolicy xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema">
	<!-- 
    This ensures the required information for directory mapping is present in the CSR
    Note that a commonName seems not to be sufficient anymore when NPS is in use.
  -->
	<SubjectAlternativeName>
		<SubjectRule>
			<Field>sAMAccountName</Field>
			<Mandatory>false</Mandatory>
			<Patterns>
				<Pattern>
					<Expression>^.*$</Expression>
					<Action>Deny</Action>
				</Pattern>
			</Patterns>
		</SubjectRule>
	</SubjectAlternativeName>
	<Subject>
		<SubjectRule>
			<Field>commonName</Field>
			<Mandatory>false</Mandatory>
			<Patterns>
				<Pattern>
					<Expression>^.*$</Expression>
					<Action>Allow</Action>
				</Pattern>
			</Patterns>
		</SubjectRule>
	</Subject>
</CertificateRequestPolicy>